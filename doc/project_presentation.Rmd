---
title: "Project presentation Group 4"
subtitle: "Composition of snake venom"
author: "Nikolas Thuesen (s152993), Gitte Aasbjerg, SÃ¸ren H. Dam & Sofie O. Villumsen"
date: "May 14th 2020"
runtime: shiny
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(plotly)
library(shiny)
source("../R/99_proj_func.R")
```


## Project requirements
Follow the IMRAD standard scientific structure:
- Introduction
- Materials and Methods
- Results (And)
- Discussion
With a technical focus, but minding to communicate which-ever biological insights you arrived at

Should not include all your code (we will look into that at the individual examinations), but rather focus on the broader picture of what you did and include data summaries and visualisations

Created using ioslides_presentation rmarkdown (i.e. the right-most doc column in the project organisation will be a rmarkdown based presentation)



## Introduction
- Intro to snake venom
- Data set for the study: 
  - Venom compositions from snakes all around the world
- Goal of study:
  - Group snakes by genus based on venom composition (PCA, K-means, ANN)
  
## The dataset
- Main data
- New data, adding three snakes from litterature

## Materials and methods
- Talk about how the data sets are merged 
- Talk about which methods have been used to reach the goal for the study (PCA, K-means, ANN)

## Results from cleaning and augmenting the data
- Show dirty data vs. clean data
- Show region, family, genus, species rows
- Show grouping of the toxin families columns

## Augmented data
```{r}
# Load augmented data
data_aug <- read_csv("../data/03_data_aug.csv")
```


## Results from PCA and K-means
<!-- - Plots -->
<!-- ![image](../results/06_pca.png) -->
```{r out.width = "90%"}
pca_path = "../results/06_continent_pca.png"
include_graphics(pca_path)

```


## Test
```{r out.width = "90%"}
toxins <- data_aug %>% 
  select_if(is.numeric)
# Bar chart comparing within snake species
p <- data_aug %>% 
  filter(Snake == "Naja kaouthia") %>%
  mutate(Snake = paste(Snake, " (",
                    row_number(), ")",
                    sep = "")) %>%
  pivot_longer(colnames(toxins),
               names_to = "Toxin",
               values_to = "Value") %>% 
  # mutate(Value = round(Value, 2)) %>% 
  arrange(desc(Snake)) %>% 
  ggplot(aes(x = Snake, y = Value, fill = Toxin)) +
  geom_col() +
  coord_flip() +
  theme(legend.position = "none") +
  ylab('Venom composition (%)')
ggplotly(p)
```

## Test 2
```{r out.width = "90%"}
family_toxins <- data_aug %>% 
  pivot_longer(colnames(toxins),
               names_to = "Toxin",
               values_to = "Value") %>% 
  group_by(Family, Toxin) %>%
  summarise(mean(Value)) %>%
  mutate(Value = round(`mean(Value)`, 2)) %>%
  ggplot(aes(x = Family, y = Value, fill = Toxin)) +
  geom_col() +
  coord_flip() +
  labs(title = "Mean Venom Composition of Viperidae and Elapidae",
       y = "Mean venom composition (%)") +
  theme(legend.position = "none")
ggplotly(family_toxins) 
```


## Results from ANN
- Plots


## Discussion
- Discuss results, what can we say about the data based on the study

 
## Shiny app
```{r, echo=FALSE}
ui <- fluidPage(
  fluidRow(
    column(4,
           wellPanel(
             textInput("snake1", "Snake:", value = "Bothrops atrox"),
             textInput("snake2", "Another snake:", value = "Naja kaouthia")
           )
    ),
    column(8,
           plotlyOutput("plot", height = "400px"))
  )
)

apply_filter <- function(data, input){
  snakes <- str_c(c(input$snake1, input$snake2), collapse = "|")
  
  if( snakes == "|" ){
    snakes <- NULL
  }else if( endsWith(snakes, "|") ){
    snakes <- input$snake1
  }else if( startsWith(snakes, "|") ){
    snakes <- input$snake2
  }

  if( !is.null(snakes) ){
    data <- data %>% 
          filter(str_detect(str_to_lower(Snake), str_to_lower(snakes)))
  }else{data}
}

server <- function(input, output) {
  dataset <- reactive({
      data_aug %>%
        apply_filter(input) %>% 
        pivot_longer(colnames(toxins),
               names_to = "Toxin",
               values_to = "Value") %>% 
        group_by(Snake, Toxin) %>%
        summarise(mean(Value)) %>%
        mutate(Value = round(`mean(Value)`, 2)) %>%
        filter(Value > 0)
    })
    
  output$plot <- renderPlotly({
    plot <- dataset() %>% 
      ggplot(aes(y = Snake, x = Value, fill = Toxin)) +
      geom_col() +
      labs(y = 'Venom composition (%)', 
       title = "Comparing venom composition",  
       subtitle = "Viperidae: 'Bothrops atrox', Elapidae: 'Naja kaouthia'" ) +
      theme(legend.position = "none")
  })
}
shinyApp(ui = ui, server = server)

## Slide with R Output

```

## Slide with Plot

```{r pressure}
plot(pressure)
```
